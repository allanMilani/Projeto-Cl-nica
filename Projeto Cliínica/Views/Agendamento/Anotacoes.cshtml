@{ ViewData["Title"] = "Anotações"; }
@model Projeto_Cliínica.Models.Agendamento
<form action="/Agendamento/Anotacoes" method="post" id="frmCreateAnotacoes">
    <div class="row">
        <input type="hidden" asp-for="ID" class="idAgendamento" />
        <div class="col-12 col-md-4">
            <div class="form-group">
                <label asp-for="@Model.HoraInicio"></label>
                <input asp-for="@Model.HoraInicio" class="form-control horaInicio" required />
                <span asp-validation-for="@Model.HoraInicio" class="text-danger small"></span>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="form-group">
                <label asp-for="@Model.HoraFim"></label>
                <input asp-for="@Model.HoraFim" class="form-control horaFim" required />
                <span asp-validation-for="@Model.HoraFim" class="text-danger small"></span>
            </div>
        </div>
    
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label asp-for="@Model.Chave"></label>
                        <input asp-for="@Model.Chave" class="form-control chave" required />
                        <span asp-validation-for="@Model.Chave" class="text-danger small"></span>
                    </div>
                </div>
      
        <div class="col-12 col-md-12">
            <div class="form-group">
                <label asp-for="@Model.AnotacoesMedico"></label>
                <textarea asp-for="@Model.AnotacoesMedico" class="form-control anotacoes" required></textarea>
                <span asp-validation-for="@Model.AnotacoesMedico" class="text-danger small"></span>
            </div>
        </div>
        <div class="col-12">
            <div class="form-group">
                <button type="submit" id="btnCriarAnotacoes" class="btn btn-primary">Salvar</button>
            </div>
        </div>
        <div class="col-12">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        </div>
    </div>
</form>
<script>
    jQuery(document).ready(function ($) {
        $("#btnCriarAnotacoes").on("click", function (event) {
            if ($("#frmCreateAnotacoes")[0].checkValidity() == false)
                return;
            else {
                event.preventDefault();
                event.stopPropagation();

                const $form = $("#frmCreateAnotacoes");
                const dadosForm = new FormData($form[0]);
                const urlForm = $form.attr("action");
                const method = $form.attr("method");
               
                $.ajax({
                    type: method,
                    url: urlForm,
                    data: dadosForm,
                    cache: false,
                    contentType: false,
                    processData: false,
                    beforeSend: function () {
                        $form.find("button").html(
                            "<span class='spinner-border spinner-border-sm' role='status' aria-hidden='true'></span>&nbsp;Salvar"
                        ).attr("disabled", true);
                    },
                    success: function (response) {
                        $form[0].reset();
                        Swal.fire({
                            icon: 'success',
                            title: 'Sucesso!',
                            text: 'Anotação salva com sucesso'
                        });
                        window.location.href = '/Agendamento/';
                    },
                    error: function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Ops, ocorreu um erro inesperado no cadastro da anotação',
                            text: response.responseText
                        })
                    }
                }).always(function (response) {
                    $form.find("button").html("Salvar").removeAttr("disabled");
                });
            }
        });
    });
</script>